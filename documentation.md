# Документация

## Общая схема работы программы 
1. Настройка логирования
2. Парсинг аргументов командной строки
3. Чтение и парсинг конфигурационных файлов, получение из них конфигурационных параметров
4. Формирование спарк-сессии
5. Чтение базы данных
6. Расчет свечей
7. Сохранение их файлы
8. Остановка спарк-сессии

## Краткое описание классов
### `CandleConfig`
Отвечает за хранение параметров свеч, получает их через словарь и/или через отдельные аргументы.  

Методы:
``` python
__init__(
    self,
    params: dict = {},
    width_ms="300000",
    date_from="19000101",  # yyyyMMdd
    date_to="20200101",  # yyyyMMdd
    time_from="1000",  # HHmm
    time_to="1800"  # HHmm
)
```

### `Config`
Отвечает за хранение и извлечение параметров запуска программы из файлов, содержит в себе класс CandleConfig.  

Методы:
``` python
__init__(
    self,
    args: dict,
) 
_parse_xml_file(self, file) -> dict # Парсит XML файл, возвращает словарь состоящий из всех извлеченных параметров (нужен для получения параметров свечей)
```

## Краткое описание работы всех функций 
Здесь я буду при помощи "--" обозначать, что функция вызывается внутри другой. Порядок описания функций соответствует порядку их вызова в программе.
``` python
setup_logger(log_dir: Path = Path(DEF_LOG_DIR)) # Настраивает логгер и хэндлеры для вывода в консоль и в файл
parse_args() # Парсит аргументы командной строки
Config(args) # Формирование объекта Config
make_candles(config: Config) # Главная функция выполняет вычисление и сохранение свечей в файлы
-- config_spark_session() -> SparkSession # Настраивает и создает спарк-сессию
-- get_trades_dataframe(spark: SparkSession, config: Config) -> DataFrame # Чтение базы данных и формирование датафрейма сделкок
-- calculate_candles(trades: DataFrame, candle_config: CandleConfig) -> DataFrame # Выполняет все вычисления свечей, возвращает датафрейм свечей (ленивые)
-- format_candle(candles: DataFrame) -> DataFrame # Выполняет форматирование свечей (округление полей, форматирование времени, триминг)
-- save_candles(candles: DataFrame, config: Config) # Сохраняет свечи в файлы 
   -- try_remove_dir(dir: str) # Удаляет директорию и все поддиректории 
```
